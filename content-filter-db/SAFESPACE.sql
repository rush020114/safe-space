# 회원
CREATE TABLE MEMBER(
   MEM_ID INT PRIMARY KEY AUTO_INCREMENT  # 아이디
   , MEM_EMAIL VARCHAR(100) UNIQUE NOT NULL    # 이메일
   , MEM_PW VARCHAR(255) NOT NULL              # 비밀번호
   , MEM_NAME VARCHAR(30) NOT NULL             # 이름
   , MEM_ROLE VARCHAR(30) NOT NULL DEFAULT 'USER' # 권한 (USER, ADMIN)
   , CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP  # 생성일
   , MEM_STATUS VARCHAR(10) DEFAULT 'ACTIVE' # 이용자 상태 (ACTIVE, WARNING, BANNED)
   , WARNING_CNT INT DEFAULT 0               # 경고 횟수
   , BANNED_UNTIL TIMESTAMP                  # 정지일     
);

# 게시글
CREATE TABLE POST (
	POST_ID INT PRIMARY KEY                    # 게시글 번호
	, POST_TITLE VARCHAR(100) NOT NULL         # 게시글 제목
	, POST_CONTENT VARCHAR(1000) NOT NULL      # 게시글 내용
	, IS_FILTERED CHAR(1) NOT NULL DEFAULT 'N' # 필터링 여부 (Y/N)
	, CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP # 작성일
	, MEM_ID INT REFERENCES MEMBER(MEM_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

# 게시글 이미지
CREATE TABLE POST_IMG(
	IMG_NUM INT PRIMARY KEY AUTO_INCREMENT     # 이미지번호
	, ORIGIN_IMG_NAME VARCHAR(100) NOT NULL    # 원본 이미지명
	, ATTACHED_IMG_NAME VARCHAR(100) NOT NULL  # 첨부 이미지명
	, POST_ID INT REFERENCES post (POST_ID) ON DELETE CASCADE
);

# 댓글
CREATE TABLE CMT (
	CMT_ID INT PRIMARY KEY AUTO_INCREMENT                        # 댓글 번호
	, CMT_CONTENT VARCHAR(500) NOT NULL                          # 댓글 내용
	, CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP    # 작성일
	, IS_FILTERED CHAR(1) NOT NULL DEFAULT 'N'                   # 필터링 여부(Y/N)
	, POST_ID INT NOT NULL                                       
	, MEM_ID INT NOT NULL                                        
	, FOREIGN KEY (POST_ID) REFERENCES POST(POST_ID) ON DELETE CASCADE
	, FOREIGN KEY (MEM_ID) REFERENCES MEMBER(MEM_ID) ON DELETE CASCADE
);

# 신고
CREATE TABLE REPORT (
	REPORT_ID INT PRIMARY KEY AUTO_INCREMENT                # 신고 아이디
	, TARGET_TYPE VARCHAR(10) NOT NULL                      # 신고 유형
	, TARGET_ID INT NOT NULL                                # 게시글/댓글 아이디
	, REPORT_REASON VARCHAR(30) NOT NULL                    # 신고 사유
	, REPORT_STATUS VARCHAR(10) NOT NULL DEFAULT 'PENDING'  # 신고 상태 (PENDING/APPROVED/REJECTED)
	, CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP        # 신고일
	, REPORTER_ID INT NOT NULL
	, FOREIGN KEY (REPORTER_ID) REFERENCES member (MEM_ID)           
	, UNIQUE KEY UNIQUE_REPORT (REPORTER_ID, TARGET_TYPE, TARGET_ID)
);

# 제재
CREATE TABLE SANCTION (
	SANCTION_ID INT PRIMARY KEY AUTO_INCREMENT                # 제재 아이디
	, SANCTION_TYPE VARCHAR(15) NOT NULL                      # 제재 유형 (WARNING/BAN_TEMP/BAN_PERMANENT)
	, SANCTION_REASON VARCHAR(50) NOT NULL                    # 제재 사유
	, START_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP # 제재 시작일
	, END_DATE TIMESTAMP                                      # 제재 만료일 (영구 제대 NULL)
	, MEM_ID INT NOT NULL
	, ADMIN_ID INT NOT NULL
	, FOREIGN KEY (MEM_ID) REFERENCES member (MEM_ID)
	, FOREIGN KEY (ADMIN_ID) REFERENCES member (MEM_ID)
);


SELECT * FROM member;
SELECT * FROM post;
SELECT * FROM POST_IMG;
SELECT * FROM CMT;
SELECT * FROM report;


